# AntMan 제품 요구사항 명세서 (PRD)

## 1. 제품 목적 및 개요

**AntMan**은 웹 페이지에서 정보를 스크래핑하여 자동으로 문서를 생성하는 Django 기반 웹 애플리케이션입니다. 주요 기능으로는 CBD 방법론에 서술된 산출물들을 프로젝트 소스코드와 프로젝트 웹사이트에 접속하여, 회사 내부 프레임워크에 맞춰진 내부 산출물을 자동으로 생성하는 프로그램입니다.

사내에서 너무 반복적인 문서작업이 반복되어 이를 자동화하여 문서품질을 일관되게 유지하고 업무효율성을 향상시킵니다.

사용부서는 에이전시프로 사내 프레임워크인 WASF사용자들입니다. 사용자들은 모든 프로젝트에 접근할 수 있는 ADMIN과 특정 프로젝트에만 접근할 수 있는 일반 사용자로 나뉘어집니다.

## 2. 핵심 기능 요구사항

### 2.1 자동생성할 CBD 산출물 유형
- 단위테스트 시나리오
- 통합테스트 시나리오
- 사용자매뉴얼
- 테스트 결과
- 메뉴구성도
- 테이블명세서
- 논리데이터모델
- 화면설계서
- 프로그램명세서

### 2.2 필수기능목록
#### A. 프로젝트별 접근
- 프로젝트 소스 저장소 접근 (GITLAB)
- 프로젝트 DB 접근 (ORACLE, POSTGRESQL)
- 프로젝트 웹사이트 접근

#### B. 프로젝트별 관리
- 위 프로젝트의 정보를 관리할 수 있어야함
- 관리정보는 프로젝트 소스 저장소 url, 프로젝트 DB url, 프로젝트 웹사이트 url, 프로젝트 로그인 id로 구성됨

#### C. 웹스크래핑 엔진
- SELENIUM 각 프로젝트별로 자동 로그인
- IFRAME으로 구성된 각 메뉴에 접속할 수 있어야함
- 전체 메뉴만 접속할 수도 있고, 특정 메뉴만 접속할 수도 있어야함

#### D. 소스코드 정적분석 엔진
- 특정 메뉴의 JS JSP JAVA XML을 분석할 수 있어야함

#### E. DB 접근
- DB를 접근하여 테이블명세서 등 DDL의 정보를 가져올 수 있어야함

### 2.3 각 산출물별 스크래핑 대상 정보 및 생성 로직 개요

#### 단위테스트 시나리오
- **사용 엔진**: 소스코드 정적분석 엔진
- **생성 로직**: 함수별 입력값과 예상 출력값을 자동 추출하여 테스트 케이스 생성
- **결과물 포맷**: Excel, Word

#### 통합테스트 시나리오
- **사용 엔진**: 소스코드 정적분석 엔진, 웹스크래핑 엔진
- **생성 로직**: 컴포넌트 간 의존성을 분석하여 통합 테스트 흐름 생성
- **결과물 포맷**: Excel, Word

#### 사용자매뉴얼
- **사용 엔진**: 웹스크래핑 엔진
- **생성 로직**: 웹 페이지 구조 분석 후 사용자 흐름에 따른 매뉴얼 자동 생성
- **결과물 포맷**: Word, PDF

#### 테스트 결과
- **사용 엔진**: 웹스크래핑 엔진
- **생성 로직**: 테스트 실행 결과 분석 후 성공/실패 보고서 생성
- **결과물 포맷**: Excel, Word

#### 메뉴구성도
- **사용 엔진**: 웹스크래핑 엔진, 소스코드 정적분석 엔진
- **생성 로직**: 사이트맵 생성 알고리즘을 통한 메뉴 계층 구조 추출
- **결과물 포맷**: Excel, Visio

#### 테이블명세서
- **사용 엔진**: DB 접근 엔진
- **생성 로직**: DB 메타데이터 분석을 통한 테이블 구조 및 관계 문서화
- **결과물 포맷**: Excel

#### 논리데이터모델
- **사용 엔진**: DB 접근 엔진
- **생성 로직**: ERD 자동 생성 및 논리적 데이터 흐름 분석
- **결과물 포맷**: Excel, Visio

#### 화면설계서
- **사용 엔진**: 웹스크래핑 엔진
- **생성 로직**: 페이지별 UI 요소 추출 및 레이아웃 분석을 통한 설계서 생성
- **결과물 포맷**: Word, PowerPoint

#### 프로그램명세서
- **사용 엔진**: 소스코드 정적분석 엔진, DB 접근 엔진
- **생성 로직**: 코드 정적 분석을 통한 프로그램 구조 및 기능 문서화
- **결과물 포맷**: Word, Excel

### 2.4 데이터 처리 흐름도

1. **데이터 수집 단계**
   - GitLab API를 통한 소스코드 접근
   - 데이터베이스 연결을 통한 스키마 정보 수집
   - 웹 크롤링을 통한 UI 요소 및 사이트 구조 수집

2. **데이터 분석 단계**
   - 소스코드 정적 분석
   - 데이터베이스 메타데이터 분석
   - 웹 페이지 구조 분석

3. **문서 생성 단계**
   - 산출물 유형별 템플릿 적용
   - 분석된 데이터를 템플릿에 매핑
   - 최종 문서 생성 및 포맷팅

4. **저장 및 제공 단계**
   - 생성된 문서 DB 저장
   - 사용자 권한에 따른 문서 접근 제공
   - 문서 다운로드 및 공유 기능

## 3. 기술 스펙

### 3.1 시스템 구조
- DJANGO (MVC+서비스 레이어)
- 내부 프레임워크는 소스코드 정적분석을 통해서 진행
- htmx 사용
- Bootstrap, DaisyUI 사용
- sqlite 사용

### 3.2 시스템 아키텍처 다이어그램

```
+---------------------+     +---------------------+     +---------------------+
|                     |     |                     |     |                     |
|  프론트엔드 (View)   |<--->|  백엔드 (Controller) |<--->|  서비스 레이어      |
|  - 사용자 인터페이스  |     |  - 요청 처리        |     |  - 비즈니스 로직    |
|  - 결과 표시        |     |  - 라우팅           |     |  - 데이터 처리      |
|                     |     |                     |     |                     |
+---------------------+     +---------------------+     +----------+----------+
                                                                 |
                                                                 v
+---------------------+     +---------------------+     +---------------------+
|                     |     |                     |     |                     |
|  외부 시스템 연동    |     |  데이터베이스 (Model) |<--->|  스크래핑 엔진     |
|  - GitLab API      |<--->|  - 프로젝트 정보     |     |  - 웹 크롤러        |
|  - DB 커넥터       |     |  - 사용자 정보       |     |  - 코드 분석기      |
|  - 웹사이트 접근    |     |  - 산출물 저장       |     |  - 문서 생성기      |
|                     |     |                     |     |                     |
+---------------------+     +---------------------+     +---------------------+
```

### 3.3 데이터베이스 스키마 설계

#### 프로젝트 테이블
```
Project
- id (PK)
- name
- description
- git_repository_url
- database_connection_string
- web_id
- web_password
- created_at
- updated_at
```

#### 사용자 테이블
```
User
- id (PK)
- username
- password_hash
- email
- is_admin
- created_at
- updated_at
```

#### 프로젝트-사용자 매핑 테이블
```
ProjectUser
- id (PK)
- project_id (FK)
- user_id (FK)
- role
- created_at
```

#### 산출물 테이블
```
Artifact
- id (PK)
- project_id (FK)
- type (단위테스트/통합테스트/사용자매뉴얼 등)
- content
- created_at
- updated_at
- created_by (FK to User)
```

### 3.4 외부 시스템 연동 방식 상세

#### GitLab 연동
- GitLab API를 통한 저장소 접근
- OAuth 인증 방식 사용
- 소스코드 클론 및 분석을 위한 임시 저장소 활용

#### 데이터베이스 연동
- 다양한 DB 타입(ORACLE, POSTGRESQL) 지원을 위한 추상화 레이어 구현
- 연결 정보 암호화 저장
- 읽기 전용 접근으로 데이터 안전성 보장

#### 웹사이트 접근
- Headless 브라우저 기반 크롤링 엔진 활용
- 사이트맵 자동 생성 및 페이지 구조 분석
- UI 요소 추출 및 상호작용 흐름 분석

## 4. 사용자 인터페이스

### 4.1 주요 화면 구성
- 웹화면으로 구성
- 메뉴구조도는 프로젝트관리, 사용자 관리, 산출물 작성(하위로 각각의 산출물을 산출할 수 있는 메뉴가 있어야함)

### 4.2 주요 화면 와이어프레임/목업

#### 대시보드 화면
대시보드 화면은 사용자가 로그인 후 처음 접하는 메인 화면입니다. 상단에는 애플리케이션 이름과 사용자 정보가 표시되며, 우측에 로그아웃 버튼이 있습니다. 좌측에는 메뉴 네비게이션이 위치하며, 프로젝트 관리, 사용자 관리, 산출물 작성 등의 주요 메뉴가 표시됩니다. 산출물 작성 메뉴는 확장 가능하며, 클릭 시 9가지 산출물 유형이 하위 메뉴로 표시됩니다. 중앙 영역에는 프로젝트 현황 섹션이 있어 최근 프로젝트와 최근 생성된 산출물 목록을 보여줍니다. 하단에는 빠른 산출물 생성 섹션이 있어 프로젝트와 산출물 유형을 선택하여 바로 생성을 시작할 수 있습니다.

#### 프로젝트 관리 화면
프로젝트 관리 화면은 상단에 제목과 사용자 정보가 표시됩니다. 화면 상단에는 새 프로젝트 추가 버튼과 검색창이 위치합니다. 중앙에는 프로젝트 목록이 테이블 형태로 표시되며, ID, 프로젝트명, Git 저장소 URL, DB 유형, 생성일 등의 정보와 함께 각 프로젝트별로 수정/삭제 버튼이 제공됩니다. 테이블 하단에는 페이지네이션 컨트롤이 있어 여러 페이지의 프로젝트 목록을 탐색할 수 있습니다.

#### 산출물 생성 화면
산출물 생성 화면은 상단에 현재 위치(예: AntMan > 산출물 작성 > 테이블명세서)와 사용자 정보가 표시됩니다. 화면 상단에는 프로젝트 선택 드롭다운이 있습니다. 중앙 영역에는 선택한 산출물 유형에 따른 스크래핑 설정 옵션들이 제공됩니다. 예를 들어, 테이블명세서의 경우 모든 테이블 포함, 시스템 테이블 제외, 특정 스키마만 포함 등의 옵션이 체크박스로 제공됩니다. 출력 형식 선택 옵션도 제공되며, Excel, Word, PDF 등의 형식 중 선택할 수 있습니다. 화면 하단에는 생성 시작 버튼과 취소 버튼이 위치합니다.

### 4.3 사용자 권한별 화면 접근성 차이

#### ADMIN 사용자
- 모든 프로젝트 접근 및 관리 가능
- 사용자 관리 메뉴 접근 가능
- 모든 산출물 생성 및 조회 가능
- 시스템 설정 메뉴 접근 가능

#### 일반 사용자
- 할당된 프로젝트만 접근 가능
- 사용자 관리 메뉴 접근 불가
- 할당된 프로젝트의 산출물만 생성 및 조회 가능
- 시스템 설정 메뉴 접근 불가

## 5. 코드 구조 및 아키텍처

### 5.1 프로젝트 디렉토리 구조

```
antman/
├── docker/                     # Docker 관련 파일
│   ├── Dockerfile
│   ├── docker-compose.yml
│   └── nginx/                  # Nginx 설정
├── docs/                       # 프로젝트 문서
├── antman/                     # 메인 Django 프로젝트
│   ├── __init__.py
│   ├── settings/               # 환경별 설정 파일
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── development.py
│   │   └── production.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
├── apps/                       # Django 애플리케이션
│   ├── common/                 # 공통 모듈
│   │   ├── __init__.py
│   │   ├── models.py
│   │   ├── services.py
│   │   ├── views.py
│   │   └── tests.py
│   ├── projects/               # 프로젝트 관리 앱
│   │   ├── __init__.py
│   │   ├── models.py
│   │   ├── services.py
│   │   ├── views.py
│   │   └── tests.py
│   ├── users/                  # 사용자 관리 앱
│   │   ├── __init__.py
│   │   ├── models.py
│   │   ├── services.py
│   │   ├── views.py
│   │   └── tests.py
│   └── artifacts/              # 산출물 생성 앱
│       ├── __init__.py
│       ├── models.py
│       ├── services.py
│       ├── views.py
│       └── tests.py
├── core/                       # 핵심 엔진 모듈
│   ├── __init__.py
│   ├── scraper/                # 웹스크래핑 엔진
│   │   ├── __init__.py
│   │   ├── selenium_manager.py
│   │   └── iframe_handler.py
│   ├── analyzer/               # 소스코드 정적분석 엔진
│   │   ├── __init__.py
│   │   ├── java_analyzer.py
│   │   ├── js_analyzer.py
│   │   ├── jsp_analyzer.py
│   │   └── xml_analyzer.py
│   └── db/                     # DB 접근 엔진
│       ├── __init__.py
│       ├── oracle_connector.py
│       └── postgresql_connector.py
├── templates/                  # HTML 템플릿
│   ├── base.html
│   ├── projects/
│   ├── users/
│   └── artifacts/
├── static/                     # 정적 파일
│   ├── css/
│   ├── js/
│   └── images/
├── media/                      # 사용자 업로드 파일
├── manage.py                   # Django 관리 스크립트
├── requirements.txt            # 패키지 의존성
├── .gitignore
└── README.md
```

### 5.2 모듈 구성 방식

AntMan 프로젝트는 다음과 같은 모듈 구성 방식을 따릅니다:

1. **Django 애플리케이션 모듈화**
   - 기능별로 분리된 Django 앱으로 구성
   - 각 앱은 독립적인 기능 단위로 설계
   - 앱 간 의존성은 명시적으로 관리

2. **핵심 엔진 모듈화**
   - 웹스크래핑 엔진, 소스코드 정적분석 엔진, DB 접근 엔진을 별도 모듈로 분리
   - 각 엔진은 인터페이스를 통해 추상화하여 구현 세부사항 은닉
   - 확장성을 고려한 플러그인 아키텍처 적용

3. **서비스 레이어 패턴**
   - 비즈니스 로직을 서비스 클래스로 캡슐화
   - 컨트롤러(뷰)와 모델 사이의 중간 레이어로 작동
   - 재사용 가능한 비즈니스 로직 모듈화

4. **유틸리티 모듈**
   - 공통 기능은 유틸리티 모듈로 분리
   - 문서 생성, 포맷 변환, 로깅 등의 기능 포함
   - 전체 프로젝트에서 일관되게 사용

### 5.3 레이어 분리 방식 (MVC 구현 상세)

Django의 MVT(Model-View-Template) 패턴을 기반으로 하되, 서비스 레이어를 추가한 확장된 아키텍처를 적용합니다:

1. **모델 레이어 (Model)**
   - 데이터 구조와 데이터베이스 스키마 정의
   - 데이터 유효성 검증 로직 포함
   - ORM을 통한 데이터베이스 작업 추상화
   - 파일 위치: `apps/*/models.py`

2. **서비스 레이어 (Service)**
   - 비즈니스 로직 캡슐화
   - 트랜잭션 관리 및 복잡한 데이터 처리
   - 여러 모델 간의 상호작용 조정
   - 외부 시스템(GitLab, DB 등) 연동 로직 처리
   - 파일 위치: `apps/*/services.py`

3. **컨트롤러 레이어 (View in Django)**
   - HTTP 요청 처리 및 응답 생성
   - 사용자 입력 검증
   - 서비스 레이어 호출 및 결과 처리
   - 적절한 템플릿 선택 및 컨텍스트 제공
   - 파일 위치: `apps/*/views.py`

4. **템플릿 레이어 (Template)**
   - 사용자 인터페이스 표현
   - 데이터 렌더링 및 표시 로직
   - 재사용 가능한 UI 컴포넌트
   - 파일 위치: `templates/`

5. **정적 자원 레이어**
   - CSS, JavaScript, 이미지 등의 정적 자원
   - 클라이언트 측 로직 및 스타일링
   - 파일 위치: `static/`

**레이어 간 통신 흐름:**

1. 클라이언트 요청 → URL 라우팅 → 뷰(컨트롤러)
2. 뷰 → 서비스 레이어 호출
3. 서비스 레이어 → 모델 및 외부 시스템과 상호작용
4. 서비스 레이어 → 결과 반환 → 뷰
5. 뷰 → 템플릿 렌더링 → 클라이언트 응답

## 6. 코딩 표준

### 6.1 코드 문서화 규칙 (주석 작성법)

모든 코드는 다음 문서화 규칙을 따라야 합니다:

1. **모듈 수준 문서화**
   - 각 Python 파일(.py)의 시작 부분에 모듈의 목적과 내용을 설명하는 문서 문자열 작성
   - 작성자, 생성일, 마지막 수정일 포함

   ```python
   """
   프로젝트 산출물 생성 서비스 모듈.
   
   이 모듈은 다양한 CBD 산출물을 자동으로 생성하는 서비스 클래스를 제공합니다.
   
   작성자: 홍길동
   생성일: 2025-01-15
   마지막 수정일: 2025-05-01
   """
   ```

2. **클래스 문서화**
   - 모든 클래스에 목적, 책임, 사용법을 설명하는 문서 문자열 작성
   
   ```python
   class TableSpecificationService:
       """
       테이블명세서 생성 서비스.
       
       데이터베이스 메타데이터를 분석하여 테이블명세서를 생성합니다.
       
       Attributes:
           db_connector: 데이터베이스 연결 객체
           output_format: 출력 형식 (excel, word 등)
       """
   ```

3. **메소드/함수 문서화**
   - 모든 공개 메소드와 함수에 목적, 매개변수, 반환값, 예외를 설명하는 문서 문자열 작성
   
   ```python
   def generate_table_specification(self, project_id, schema_name=None):
       """
       테이블명세서를 생성합니다.
       
       Args:
           project_id (int): 프로젝트 ID
           schema_name (str, optional): 스키마 이름. None인 경우 모든 스키마 포함.
           
       Returns:
           str: 생성된 문서의 파일 경로
           
       Raises:
           DatabaseConnectionError: 데이터베이스 연결 실패 시
           InvalidProjectError: 유효하지 않은 프로젝트 ID인 경우
       """
   ```

4. **인라인 주석**
   - 복잡한 로직이나 비직관적인 코드에 인라인 주석 추가
   - 주석은 코드가 "무엇을 하는지"가 아닌 "왜 그렇게 하는지" 설명
   
   ```python
   # IFRAME 내부 요소에 접근하기 위해 컨텍스트 전환
   driver.switch_to.frame(iframe_element)
   ```

5. **TODO 주석**
   - 미완성 기능이나 향후 개선 사항에 TODO 주석 사용
   
   ```python
   # TODO: 대용량 테이블 처리 시 성능 최적화 필요
   ```

### 6.3 단위 테스트 작성 규칙

단위 테스트는 다음 규칙에 따라 작성됩니다:

1. **테스트 구조**
   - 테스트 클래스는 `Test`로 시작하고 테스트 대상 클래스 이름을 포함
   - 테스트 메소드는 `test_`로 시작하고 테스트 대상 기능 설명 포함